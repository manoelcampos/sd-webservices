:source-highlighter: highlightjs
:numbered:

= Exemplo de Aplica√ß√£o REST utilizando Java com API JAX-RS e o framework Quarkus

Este projeto usar o framework https://quarkus.io[Quakus] para compilar e executar uma aplica√ß√£o
java que disponibiliza servi√ßos REST utilizando a API JAX-RS.
O Quarkus √© o que h√° de mais recente e moderno para o desenvolvimento e execu√ß√£o
de diferentes aplica√ß√µes Java, como Java EE (atualmente Jakarta EE).

O Quarkus permite compilar o c√≥digo Java para c√≥digo nativo usando a https://graalvm.org[GraalVM]
no lugar da JVM. A GraalVM √© tamb√©m um projeto recente que permite compilar aplica√ß√µes em uma infinidade de linguagens para c√≥digo nativo. A lista de linguagens √© extensa e inclui JavaScript (e Node.js), Python, Ruby, Java, Scala, Groovy, Kotlin, etc.

== Requisitos

Tenha certeza de rodar a aplica√ß√£o com no m√°ximo o JDK 8.
Os servidores de aplica√ß√£o normalmente ainda n√£o funcionam com vers√µes mais recentes do JDK.

√â necess√°rio Maven 3.5.3 ou superior. Mesmo as vers√µes mais atuais do NetBeans
v√™m com vers√µes antigas do Maven. Por isso, ao tentar compilar o projeto no NetBeans
voc√™ pode receber o erro abaixo:

```
com.google.inject.ProvisionException: Unable to provision, see the following errors:

1) Error injecting: private org.eclipse.aether.spi.log.Logger org.apache.maven.repository.internal.DefaultVersionRangeResolver.logger
```

O maven pode ser instalado, por exemplo em distribui√ß√µes Linux baseadas em Debian,
com `sudo apt-get install maven`. 

No Windows, pode-se baixar um arquivo `apache-maven-x.x.x-bin.zip` em https://maven.apache.org/download.cgi. Voc√™ tamb√©m pode configurar o https://docs.microsoft.com/en-us/windows/wsl/install-win10[Windows Subsystem for Linux] e assim poder√° baixar aplica√ß√µes usando o mesmo comando Linux acima.

No NetBeans ent√£o √© poss√≠vel indicar que deseja-se utilizar uma vers√£o do Maven instalada no sistema, no lugar de usar a que vem com o NetBeans. 
Para isto, acesse as prefer√™ncias do NetBeans, depois a aba Java >> Maven e informe o caminho do comando "mvn" no campo "Maven Home".

== Cria√ß√£o do Projeto

Toda a estrutura do projeto foi criada com o comando abaixo, como indicado no site do https://quarkus.io/guides/getting-started-guide[Quarkus]:

```bash
mvn io.quarkus:quarkus-maven-plugin:0.17.0:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=getting-started \
    -DclassName="org.acme.quickstart.GreetingResource" \
    -Dpath="/hello"
```

== Executar o Projeto

== Ambiente de Desenvolvimento 

=== Iniciando o servidor

Voc√™ pode iniciar o servidor com sua aplica√ß√£o de diferentes maneiras:

- Usando o script mvnw inclu√≠do durante a cria√ß√£o do projeto: `./mvnw compile quarkus:dev`.
- Ou simplesmente clicando no bot√£o Play em IDEs como o NetBeans, pois foi inclu√≠do o plugin maven exec para executar o comando acima mais facilmente.

=== Atualizando o projeto sem reiniciar o servidor

Bem, atualizar o projeto no servidor em execu√ß√£o e ver as altera√ß√µes que voc√™ fez na sua aplica√ß√£o √© realmente complicado com o Quarkus: voc√™ precisa apenas salvar o projeto e boom: normalmente em menos de 1 segundo a aplica√ß√£o estar√° rodando com as novas altera√ß√µes üò±üöÄüòÅ.

N√£o √© √† toa que o slogan do Quarkus √© "Supersonic Subatomic Java".

=== Acessando a aplica√ß√£o

Se voc√™ estiver habituado a usar servidores como o GlassFish no NetBeans, sabe que ao clicar no bot√£o Play, o projeto √© compilado e executado, abrindo o navegador automaticamente.
Usando o Quarkus isso n√£o ocorrer√°.
Voc√™ deve abrir o navegador voc√™ mesmo. Neste caso, a aplica√ß√£o estar√° dispon√≠vel
em http://localhost:8080. Observe que n√£o h√° um caminho adicional com o nome da aplica√ß√£o no final da URL, pois a aplica√ß√£o executa na raiz do servidor.

== Ambiente de Produ√ß√£o

Para enviar a aplica√ß√£o para um ambiente de produ√ß√£o voc√™ deve executar `./mvnw clean package` em um terminal na raiz do projeto para criar o que chamamos de fat jar: um jar contendo a aplica√ß√£o e o servidor que executar√° a pr√≥pria aplica√ß√£o.

Com o comando acima o pacote `target/rest-app-quarkus-server-runner.jar` √© criado e a partir dele podemos iniciar o servidor com a aplica√ß√£o usando:

`java -jar target/rest-app-quarkus-server-runner.jar`

Assim, este √© o pacote que precisa enviar para o ambiente de produ√ß√£o. 
Poss√≠veis bibliotecas que a aplica√ß√£o n√£o est√£o sendo empacotadas neste jar.
Posteriormente atualizo o projeto para fazer isso.

=== Container Docker

Para gerar um container docker com tudo necess√°rio para executar a aplica√ß√£o, √© preciso ter a https://graalvm.org[GraalVM] e o https://www.docker.com/products/docker-desktop[Docker] instalados. 
O Docker precisa estar rodando na m√°quina de desenvolvimento para construir a imagem do container.
Em seguida, basta executar os comandos abaixo:

```bash
./mvnw package -Pnative -Dnative-image.docker-build=true
docker build . -f src/main/docker/Dockerfile.native -t com.manoelcampos/rest-app-quarkus-server
```

Observe que `com.manoelcampos/rest-app-quarkus-server` √© apenas uma tag para categorizar
a imagem docker criada. Voc√™ pode usar qualquer nome que quiser, seguindo o padr√£o
desenvolvedor/descricao_imagem. Para aplica√ß√µes java, um padr√£o comum √© nome_do_pacote/nome_aplicacao.

Agora, executando `docker image list` ser√° exibida a lista de imagens docker dispon√≠veis.
A imagem `com.manoelcampos/rest-app-quarkus-server` (no caso do exemplo acima) dever√° ser exibida na lista.

Voc√™ pode ver as imagens criadas com:

`docker image list`

Uma imagem com o nome "com.manoelcampos/rest-app-quarkus-server" (ou qualquer nome que voc√™ tenha dado) deve aparecer na lista. Note que a imagem docker contendo a aplica√ß√£o inteira, incluindo o servidor, ter√° menos de 40MB. S√≥ a vers√£o b√°sica do GlassFish tem 60MB. O GlassFish Full tem cerca de 120MB.

Voc√™ pode iniciar um container a partir de tal imagem com o comando:

`docker run -i --rm -p 8080:8080 com.manoelcampos/rest-app-quarkus-server`

A partir de ent√£o, a aplica√ß√£o poder√° ser acessada de dentro do container pelo endere√ßo http://localhost:8080.

== Refer√™ncias

- https://quarkus.io
- https://quarkus.io/guides/getting-started-guide
- https://quarkus.io/guides/building-native-image-guide
- https://lordofthejars.github.io/quarkus-cheat-sheet/